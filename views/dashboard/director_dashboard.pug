extends ../layout

block append content 
  //- Main Panel (includes header and content)
  .main-panel
    include ../partials/header
    
    .content(ng-controller="schoolDashboardCtrl" style="padding-top: 100px; background: #f5f7fa;")
      .container-fluid
        //- ðŸŽ¯ PROMINENT SCHOOL HEADER - Colorful and easy to spot
        .row(style="margin-bottom: 30px;")
          .col-md-12
            .card(style="box-shadow: 0 4px 20px rgba(0,0,0,0.1); border-radius: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);")
              .card-content(style="padding: 30px;")
                .row
                  .col-md-8
                    h2(style="color: white; font-size: 32px; font-weight: 700; margin: 0 0 10px 0;")
                      i.material-icons(style="font-size: 40px; vertical-align: middle; margin-right: 15px;") school
                      | #{school_name}
                    p(style="color: rgba(255,255,255,0.9); font-size: 16px; margin: 0;")
                      i.material-icons(style="font-size: 18px; vertical-align: middle;") dashboard
                      |  School Management Dashboard
                    if is_super_admin
                      .label.label-warning(style="margin-top: 10px; font-size: 14px; padding: 8px 15px;")
                        i.material-icons(style="font-size: 16px; vertical-align: middle;") star
                        |  Super Admin View
                  .col-md-4.text-right
                    //- Quick navigation buttons
                    a.btn.btn-white.btn-raised(href="/school/#{school_id}" style="margin: 5px;")
                      i.material-icons visibility
                      |  View School
                    a.btn.btn-white.btn-raised(href="/school/settings/#{school_id}" style="margin: 5px;")
                      i.material-icons settings
                      |  Settings

        //- ðŸ"Š PRIMARY METRICS - Big, colorful, clear cards
        .row
          //- Classes Card - ORANGE
          .col-lg-3.col-md-6.col-sm-6(style="margin-bottom: 20px;")
            a(href="/dashboard/classe/#{school_id}" style="text-decoration: none;")
              .card.card-stats(style="border-radius: 10px; box-shadow: 0 3px 15px rgba(255,152,0,0.2); transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'")
                .card-header.card-header-icon(data-background-color="orange" style="background: linear-gradient(60deg, #ffa726, #fb8c00) !important;")
                  i.material-icons class
                .card-content(style="padding: 20px;")
                  p.category(style="color: #999; font-size: 14px; margin-bottom: 5px;") Classes
                  - var total_classes = info.classes_ol + info.classes_al
                  h2.card-title(style="color: #3c4858; font-weight: 700; margin: 10px 0;") #{total_classes}
                .card-footer(style="padding: 15px; background: #f8f9fa; border-radius: 0 0 10px 10px;")
                  .stats(style="color: #666;")
                    i.material-icons(style="font-size: 16px; vertical-align: middle; color: #ff9800;") assignment
                    |  #{info.classes_ol} O'Level â€¢ #{info.classes_al} A'Level

          //- Students Card - BLUE
          .col-lg-3.col-md-6.col-sm-6(style="margin-bottom: 20px;")
            a(href="/school/students/#{school_id}" style="text-decoration: none;")
              .card.card-stats(style="border-radius: 10px; box-shadow: 0 3px 15px rgba(33,150,243,0.2); transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'")
                .card-header.card-header-icon(data-background-color="blue" style="background: linear-gradient(60deg, #26c6da, #00acc1) !important;")
                  i.material-icons people
                .card-content(style="padding: 20px;")
                  p.category(style="color: #999; font-size: 14px; margin-bottom: 5px;") Students
                  - var total_students = info.students_male + info.students_fem
                  h2.card-title(style="color: #3c4858; font-weight: 700; margin: 10px 0;") #{total_students}
                .card-footer(style="padding: 15px; background: #f8f9fa; border-radius: 0 0 10px 10px;")
                  .stats(style="color: #666;")
                    i.material-icons(style="font-size: 16px; vertical-align: middle; color: #00bcd4;") wc
                    |  #{info.students_male} Male â€¢ #{info.students_fem} Female

          //- Teachers Card - PURPLE
          .col-lg-3.col-md-6.col-sm-6(style="margin-bottom: 20px;")
            a(href="/dashboard/teachers/#{school_id}" style="text-decoration: none;")
              .card.card-stats(style="border-radius: 10px; box-shadow: 0 3px 15px rgba(156,39,176,0.2); transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'")
                .card-header.card-header-icon(data-background-color="purple" style="background: linear-gradient(60deg, #ab47bc, #8e24aa) !important;")
                  i.material-icons person
                .card-content(style="padding: 20px;")
                  p.category(style="color: #999; font-size: 14px; margin-bottom: 5px;") Teachers
                  - var total_teachers = info.teachers_male + info.teachers_fem
                  h2.card-title(style="color: #3c4858; font-weight: 700; margin: 10px 0;") #{total_teachers}
                .card-footer(style="padding: 15px; background: #f8f9fa; border-radius: 0 0 10px 10px;")
                  .stats(style="color: #666;")
                    i.material-icons(style="font-size: 16px; vertical-align: middle; color: #9c27b0;") group_work
                    |  #{info.teachers_male} Male â€¢ #{info.teachers_fem} Female

          //- Courses & Programs Card - GREEN
          .col-lg-3.col-md-6.col-sm-6(style="margin-bottom: 20px;")
            a(href="/dashboard/register/course/#{school_id}" style="text-decoration: none;")
              .card.card-stats(style="border-radius: 10px; box-shadow: 0 3px 15px rgba(76,175,80,0.2); transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'")
                .card-header.card-header-icon(data-background-color="green" style="background: linear-gradient(60deg, #66bb6a, #43a047) !important;")
                  i.material-icons book
                .card-content(style="padding: 20px;")
                  p.category(style="color: #999; font-size: 14px; margin-bottom: 5px;") Courses & Programs
                  - var total_courses = info.courses + info.programs
                  h2.card-title(style="color: #3c4858; font-weight: 700; margin: 10px 0;") #{total_courses}
                .card-footer(style="padding: 15px; background: #f8f9fa; border-radius: 0 0 10px 10px;")
                  .stats(style="color: #666;")
                    i.material-icons(style="font-size: 16px; vertical-align: middle; color: #4caf50;") library_books
                    |  #{info.courses} Courses â€¢ #{info.programs} Programs

        //- ðŸ"ˆ SECONDARY METRICS - Smaller cards
        .row(style="margin-top: 20px;")
          //- Administrators Card - ROSE
          .col-lg-4.col-md-6.col-sm-6(style="margin-bottom: 20px;")
            .card.card-stats(style="border-radius: 10px; box-shadow: 0 2px 10px rgba(233,30,99,0.15);")
              .card-header.card-header-icon(data-background-color="rose" style="background: linear-gradient(60deg, #ec407a, #d81b60) !important;")
                i.material-icons supervisor_account
              .card-content(style="padding: 15px;")
                p.category(style="color: #999; font-size: 13px;") Administrators
                - var total_admins = info.admins_male + info.admins_fem
                h3.card-title(style="color: #3c4858; font-weight: 600;") #{total_admins}
                small(style="color: #666;")
                  i.material-icons(style="font-size: 14px; vertical-align: middle;") wc
                  |  #{info.admins_male} Male, #{info.admins_fem} Female

          //- Alumni Card - TEAL
          .col-lg-4.col-md-6.col-sm-6(style="margin-bottom: 20px;")
            .card.card-stats(style="border-radius: 10px; box-shadow: 0 2px 10px rgba(0,150,136,0.15);")
              .card-header.card-header-icon(style="background: linear-gradient(60deg, #26a69a, #00897b) !important;")
                i.material-icons school
              .card-content(style="padding: 15px;")
                p.category(style="color: #999; font-size: 13px;") Alumni / Finalists
                h3.card-title(style="color: #3c4858; font-weight: 600;") #{info.finalists}
                small(style="color: #666;")
                  a(href="/school/finalists/#{school_id}" style="color: #00897b;")
                    i.material-icons(style="font-size: 14px; vertical-align: middle;") visibility
                    |  View finalists

          //- Total Users Card - INDIGO
          .col-lg-4.col-md-6.col-sm-6(style="margin-bottom: 20px;")
            .card.card-stats(style="border-radius: 10px; box-shadow: 0 2px 10px rgba(63,81,181,0.15);")
              .card-header.card-header-icon(style="background: linear-gradient(60deg, #5c6bc0, #3f51b5) !important;")
                i.material-icons people_outline
              .card-content(style="padding: 15px;")
                p.category(style="color: #999; font-size: 13px;") Total Active Users
                - var all_users = total_students + total_teachers + total_admins
                h3.card-title(style="color: #3c4858; font-weight: 600;") #{all_users}
                small(style="color: #666;")
                  i.material-icons(style="font-size: 14px; vertical-align: middle;") info
                  |  All roles combined

        //- ðŸš€ QUICK ACTIONS - Action buttons section
        .row(style="margin-top: 30px;")
          .col-md-12
            .card(style="border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);")
              .card-header(style="background: linear-gradient(60deg, #616161, #424242); border-radius: 10px 10px 0 0; padding: 20px;")
                h4.card-title(style="color: white; margin: 0;")
                  i.material-icons(style="vertical-align: middle; margin-right: 10px;") flash_on
                  | Quick Actions
              .card-content(style="padding: 25px;")
                .row
                  .col-md-3.col-sm-6.text-center(style="margin-bottom: 15px;")
                    a.btn.btn-info.btn-lg.btn-block(href="/school/#{school_id}" style="padding: 20px; border-radius: 8px;")
                      i.material-icons(style="font-size: 36px; display: block; margin-bottom: 10px;") visibility
                      | View Classes
                  .col-md-3.col-sm-6.text-center(style="margin-bottom: 15px;")
                    a.btn.btn-success.btn-lg.btn-block(href="/dashboard/classe/#{school_id}" style="padding: 20px; border-radius: 8px;")
                      i.material-icons(style="font-size: 36px; display: block; margin-bottom: 10px;") add_circle
                      | Manage Classes
                  .col-md-3.col-sm-6.text-center(style="margin-bottom: 15px;")
                    a.btn.btn-rose.btn-lg.btn-block(href="/school/settings/#{school_id}" style="padding: 20px; border-radius: 8px;")
                      i.material-icons(style="font-size: 36px; display: block; margin-bottom: 10px;") settings
                      | School Settings
                  .col-md-3.col-sm-6.text-center(style="margin-bottom: 15px;")
                    a.btn.btn-warning.btn-lg.btn-block(href="/dashboard/register/course/#{school_id}" style="padding: 20px; border-radius: 8px;")
                      i.material-icons(style="font-size: 36px; display: block; margin-bottom: 10px;") library_add
                      | Add Courses

        //- ðŸ"‹ CLASSES OVERVIEW - Bottom section
        .row(ng-if="classes.length > 0" style="margin-top: 30px;")
          .col-md-12
            .card(style="border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);")
              .card-header.card-header-rose(style="border-radius: 10px 10px 0 0; padding: 20px;")
                h4.card-title(style="color: white; margin: 0;")
                  i.material-icons(style="vertical-align: middle; margin-right: 10px;") list
                  | Classes Overview
              .card-content
                .table-responsive
                  table.table.table-hover(style="margin: 0;")
                    thead
                      tr(style="background: #f5f7fa;")
                        th(style="padding: 15px;") #
                        th(style="padding: 15px;") Class Name
                        th(style="padding: 15px;") Level
                        th(style="padding: 15px;") Students
                        th(style="padding: 15px;") Actions
                    tbody
                      tr(ng-repeat="classe in classes track by classe._id")
                        td(style="padding: 15px;") {{$index + 1}}
                        td(style="padding: 15px;")
                          strong {{classe.name}}
                        td(style="padding: 15px;")
                          span.label.label-info(ng-if="!classe.option" style="padding: 5px 10px; font-size: 12px;") O Level
                          span.label.label-success(ng-if="classe.option" style="padding: 5px 10px; font-size: 12px;") A Level
                        td(style="padding: 15px;")
                          span.badge.badge-primary(style="padding: 5px 10px; font-size: 13px;") {{classe.studentCount || 0}}
                        td(style="padding: 15px;")
                          a.btn.btn-sm.btn-info(href="/classe/{{classe._id}}" style="border-radius: 5px;")
                            i.material-icons(style="font-size: 16px; vertical-align: middle;") visibility
                            |  View

block append scripts
  script(src="../js/MIT/MIT_sweetalert2.js" type="text/javascript")
  script.
    var app = angular.module('eshuri_App', ['ngRoute']);
    
    app.controller('schoolDashboardCtrl', function($scope, $http) {
      // Initialize
      $scope.classes = [];
      $scope.loading = false;
      $scope.anti_csrf = "#{csrf_token}";
      
      /**
       * Load school statistics (optional - if you want dynamic updates)
       */
      $scope.loadDashboardStats = function() {
        $scope.loading = true;
        
        $http.post('/dashboard/direct/statistics', { 
          _csrf: $scope.anti_csrf,
          school_id: "#{school_id}"
        })
          .then(function(response) {
            console.log('âœ… Dashboard stats loaded:', response.data);
            // Update stats if needed
            $scope.loading = false;
          })
          .catch(function(error) {
            console.error('âŒ Error loading stats:', error);
            $scope.loading = false;
          });
      };
      
      /**
       * Load classes list (optional)
       */
      $scope.loadClasses = function() {
        $http.get('/classe/list/#{school_id}')
          .then(function(response) {
            console.log('âœ… Classes loaded:', response.data);
            $scope.classes = response.data;
          })
          .catch(function(error) {
            console.error('âŒ Error loading classes:', error);
          });
      };
      
      // Initialize
      console.log('ðŸŽ¯ School dashboard controller initialized');
      // Uncomment to load classes dynamically:
      // $scope.loadClasses();
    });
